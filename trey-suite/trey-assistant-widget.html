<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trey Assistant Widget</title>

  <!-- Loads your Supabase URL + anon from supabase.config.js -->
  <script defer src="supabase.config.js"></script>

  <!-- Base + floating styles -->
  <style>
    :root { --bff-z: 2147483647; }
    html,body { margin:0; padding:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#f7f7f8; color:#111; }
    .container { padding: 24px; max-width: 960px; margin: 0 auto; }
    .hint { color:#555; font-size:14px; margin-top:8px; }

    /* Floating button + panel (forced) */
    #bffFab {
      position: fixed !important; right: 18px !important; bottom: 18px !important; z-index: var(--bff-z) !important;
      padding: 12px 16px; border-radius: 999px; border: 0; cursor: pointer;
      box-shadow: 0 8px 24px rgba(0,0,0,.18); background:#111; color:#fff; font:600 14px/1 ui-sans-serif,system-ui;
    }
    #bffPanel {
      position: fixed !important; right: 18px !important; bottom: 86px !important; z-index: calc(var(--bff-z) - 1) !important;
      width: min(420px, calc(100vw - 32px)) !important; max-height: min(80vh, 720px) !important; overflow: hidden;
      background: #fff; border-radius: 14px; box-shadow: 0 16px 48px rgba(0,0,0,.25); display: none;
    }
    #bffPanel iframe { width: 100%; height: 70vh; border: 0; display: block; border-radius: 14px; }
    @media (max-width:520px){ #bffPanel{ right:8px !important; left:8px !important; width:auto !important; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Trey Assistant Widget</h1>
    <p>This page force-enables a floating assistant button and panel.</p>
    <p class="hint">If you donâ€™t see the button, hard refresh (Ctrl+F5).</p>
  </div>

  <!-- Floating UI (created up front) -->
  <div id="bffPanel" aria-hidden="true">
    <!-- You can change this source if your embed file lives elsewhere -->
    <iframe src="embed-snippet.html"></iframe>
  </div>
  <button id="bffFab" type="button" aria-controls="bffPanel" aria-expanded="false">Open Assistant</button>

  <!-- Logic to toggle + harden layout; also works if other markup already exists -->
  <script>
    (() => {
      const Z = 2147483647;

      const fab   = document.getElementById('bffFab') || (() => {
        const b = document.createElement('button'); b.id='bffFab'; b.type='button'; b.textContent='Open Assistant'; document.body.appendChild(b); return b;
      })();
      const panel = document.getElementById('bffPanel') || (() => {
        const d = document.createElement('div'); d.id='bffPanel'; d.innerHTML = `<iframe src="embed-snippet.html"></iframe>`; document.body.appendChild(d); return d;
      })();

      // Enforce floating styles at runtime (in case other CSS tries to override)
      Object.assign(fab.style,   { position:'fixed', right:'18px', bottom:'18px', zIndex: Z });
      Object.assign(panel.style, { position:'fixed', right:'18px', bottom:'86px', zIndex: Z-1 });

      // Toggle behavior
      const show = () => { panel.style.display = 'block'; fab.setAttribute('aria-expanded','true'); };
      const hide = () => { panel.style.display = 'none';  fab.setAttribute('aria-expanded','false'); };
      fab.addEventListener('click', () => (panel.style.display === 'none' || !panel.style.display) ? show() : hide());

      // Optional: warn if Supabase config missing (doesn't block the widget)
      window.addEventListener('load', () => {
        const cfg = (window.BFF_SUPABASE || {});
        if (!cfg.url || !cfg.anon) console.warn('Supabase config missing. Set url/anon in trey-suite/supabase.config.js');
      });
    })();
  </script>
</body>
</html>
